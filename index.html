<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon210.png">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BSK9">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>–ö–∏–±–µ—Ä–±–∞—Å–∫–µ—Ç–±–æ–ª PRO</title>
    <style>
        :root {
            --primary: #4cc9f0;
            --secondary: #f72585;
            --background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            --container-bg: rgba(0, 0, 0, 0.95);
        }

        .theme-sun { --background: linear-gradient(135deg, #ff9d00, #ff2e00, #ff0099); --primary: #ff9d00; --secondary: #ff0099; }
        .theme-moon { --background: linear-gradient(135deg, #667eea, #764ba2, #6B8DD6); --primary: #667eea; --secondary: #764ba2; }
        .theme-fullmoon { --background: linear-gradient(135deg, #4facfe, #00f2fe, #00c6fb); --primary: #4facfe; --secondary: #00f2fe; }
        .theme-newmoon { --background: linear-gradient(135deg, #2c3e50, #34495e, #1a252f); --primary: #3498db; --secondary: #2c3e50; }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
        }

        html, body {
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
            background: #000;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            width: 100vw;
            height: 100vh;
            height: 100dvh;
            background: var(--background);
            color: white;
        }

        .container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            background: var(--container-bg);
            padding-bottom: env(safe-area-inset-bottom);
        }

        .header {
            padding: max(5px, env(safe-area-inset-top)) 8px 0;
            flex-shrink: 0;
        }

        .title-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 4px;
        }

        h1 {
            color: var(--primary);
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .basket-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid var(--primary);
            border-radius: 50%;
            color: var(--primary);
            cursor: pointer;
            width: 34px;
            height: 34px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }

        .tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            padding: 2px;
            margin-bottom: 4px;
        }

        .tab {
            flex: 1;
            padding: 5px 2px;
            border: none;
            border-radius: 4px;
            background: transparent;
            color: white;
            cursor: pointer;
            font-size: 0.75rem;
        }

        .tab.active {
            background: var(--primary);
            color: black;
            font-weight: bold;
        }

        .mode-switcher {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            padding: 2px;
            margin-bottom: 4px;
        }

        .mode-btn {
            flex: 1;
            padding: 5px 2px;
            border: none;
            border-radius: 4px;
            background: transparent;
            color: white;
            cursor: pointer;
            font-size: 0.75rem;
        }

        .mode-btn.active {
            background: var(--primary);
            color: black;
            font-weight: bold;
        }

        .theme-switcher {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 3px;
        }

        .theme-btn {
            padding: 5px 1px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.65rem;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            min-height: 26px;
        }

        .theme-btn.active {
            box-shadow: 0 0 3px var(--primary);
            background: var(--primary);
            color: black;
        }

        .content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 6px;
            padding: 0 8px 8px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .tab-content {
            display: none;
            flex-direction: column;
            gap: 6px;
            height: 100%;
        }

        .tab-content.active {
            display: flex;
        }

        .period {
            background: rgba(255, 255, 255, 0.1);
            padding: 6px;
            border-radius: 6px;
        }

        h2 {
            font-size: 0.85rem;
            color: var(--secondary);
            margin-bottom: 4px;
            text-align: center;
        }

        .teams-row {
            display: flex;
            gap: 4px;
            align-items: center;
        }

        .team-input {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        label {
            font-size: 0.7rem;
            color: #bdb2ff;
            margin-bottom: 2px;
            text-align: center;
        }

        .score-input {
            width: 100%;
            padding: 6px;
            border: 2px solid var(--primary);
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.95);
            font-size: 0.9rem;
            text-align: center;
            color: #000;
            font-weight: bold;
            cursor: pointer;
        }

        .vs-text {
            color: var(--primary);
            font-weight: bold;
            font-size: 0.75rem;
            margin: 0 1px;
        }

        .result {
            text-align: center;
            font-size: 0.9rem;
            padding: 8px;
            background: rgba(76, 201, 240, 0.2);
            border-radius: 6px;
            border: 2px solid var(--primary);
            margin-top: 3px;
        }

        .additional-result {
            text-align: center;
            font-size: 0.85rem;
            padding: 6px;
            background: rgba(247, 37, 133, 0.2);
            border-radius: 6px;
            border: 2px solid var(--secondary);
            margin-top: 3px;
        }

        .visualization-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            flex: 1;
            gap: 10px;
            padding: 5px 0;
        }

        .triangle-container {
            position: relative;
            width: 180px;
            height: 180px;
            margin: 0 auto;
        }

        .triangle-svg {
            width: 100%;
            height: 100%;
        }

        .trend-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .trend-up {
            color: #4ade80;
            border: 2px solid #4ade80;
        }

        .trend-down {
            color: #f87171;
            border: 2px solid #f87171;
        }

        .trend-stable {
            color: #fbbf24;
            border: 2px solid #fbbf24;
        }

        .prediction-panel {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 8px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .prediction-panel h3 {
            color: var(--primary);
            font-size: 0.85rem;
            text-align: center;
            margin-bottom: 2px;
        }

        .prediction-method {
            padding: 6px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            border-left: 2px solid var(--secondary);
        }

        .prediction-method h4 {
            font-size: 0.75rem;
            color: var(--secondary);
            margin-bottom: 4px;
        }

        .prediction-method .result {
            font-size: 0.75rem;
            padding: 3px;
            background: transparent;
            border: none;
            margin-top: 1px;
            text-align: left;
        }

        .confidence-meter {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin-top: 4px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        /* –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –º–∞–≥–∏—á–µ—Å–∫–æ–≥–æ –∫–≤–∞–¥—Ä–∞—Ç–∞ */
        .magic-square-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            padding: 12px;
        }

        .magic-square {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 6px;
            width: 220px;
            height: 220px;
            margin: 12px auto;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 8px;
            border: 2px solid var(--primary);
        }

        .magic-cell {
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--primary);
            border-radius: 8px;
            font-size: 1.3rem;
            font-weight: bold;
            color: white;
            transition: all 0.3s ease;
            position: relative;
        }

        .magic-cell.active {
            background: var(--primary);
            color: black;
            transform: scale(1.05);
            box-shadow: 0 0 12px var(--primary);
        }

        .magic-cell.diagonal {
            border-color: var(--secondary);
        }

        .magic-cell.diagonal.active {
            background: var(--secondary);
            box-shadow: 0 0 12px var(--secondary);
        }

        .magic-cell.corner {
            border-style: double;
        }

        .magic-cell.center {
            border-width: 3px;
        }

        .cell-index {
            position: absolute;
            top: 2px;
            left: 4px;
            font-size: 0.6rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .magic-calculations {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            width: 100%;
            margin-top: 10px;
        }

        .calculation-group {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 8px;
            border-left: 3px solid var(--primary);
        }

        .calculation-group.diagonal {
            border-left-color: var(--secondary);
        }

        .calculation-title {
            font-size: 0.8rem;
            color: var(--primary);
            margin-bottom: 6px;
            font-weight: bold;
            text-align: center;
        }

        .calculation-title.diagonal {
            color: var(--secondary);
        }

        .calculation-item {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            margin-bottom: 4px;
            padding: 2px 0;
        }

        .calculation-value {
            font-weight: bold;
            color: var(--primary);
        }

        .calculation-value.diagonal {
            color: var(--secondary);
        }

        .calculation-formula {
            font-size: 0.7rem;
            color: #bdb2ff;
            text-align: center;
            margin-top: 4px;
            font-style: italic;
        }

        .magic-summary {
            background: rgba(255, 255, 255, 0.08);
            padding: 12px;
            border-radius: 10px;
            border: 2px solid var(--primary);
            margin-top: 10px;
            width: 100%;
        }

        .summary-title {
            color: var(--primary);
            font-size: 0.9rem;
            text-align: center;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            padding: 4px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .summary-label {
            font-size: 0.75rem;
            color: #bdb2ff;
        }

        .summary-value {
            font-size: 0.8rem;
            font-weight: bold;
            color: white;
        }

        .energy-level {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 8px;
        }

        .energy-bar {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .energy-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .energy-low { background: #ef4444; width: 33%; }
        .energy-medium { background: #f59e0b; width: 66%; }
        .energy-high { background: #10b981; width: 100%; }

        .magic-result {
            text-align: center;
            font-size: 1.1rem;
            padding: 12px;
            background: linear-gradient(135deg, rgba(76, 201, 240, 0.2), rgba(247, 37, 133, 0.2));
            border-radius: 10px;
            border: 2px solid var(--primary);
            margin-top: 12px;
            font-weight: bold;
            width: 100%;
        }

        .prediction-breakdown {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 8px;
        }

        .breakdown-item {
            text-align: center;
            padding: 4px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            font-size: 0.7rem;
        }

        .breakdown-value {
            font-weight: bold;
            color: var(--primary);
            font-size: 0.8rem;
        }

        .interpretation {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 3px solid var(--secondary);
        }

        .interpretation-title {
            color: var(--secondary);
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 6px;
            text-align: center;
        }

        .interpretation-text {
            font-size: 0.75rem;
            line-height: 1.3;
            text-align: center;
            color: #bdb2ff;
        }

        .magic-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 12px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.7rem;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .legend-primary {
            background: var(--primary);
        }

        .legend-secondary {
            background: var(--secondary);
        }

        .legend-corner {
            background: transparent;
            border: 2px double var(--primary);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ –°–∏–¥–∏–∫–∞ –ê–≤–≥–∞–Ω–∞ */
        .sidik-container {
            padding: 10px;
            gap: 12px;
            display: flex;
            flex-direction: column;
        }

        .sidik-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidik-card-title {
            font-size: 1.1rem;
            margin-bottom: 12px;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sidik-input-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 12px;
        }

        .sidik-input-field {
            flex: 1;
            min-width: 120px;
        }

        .sidik-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            font-size: 0.85rem;
            color: #bdb2ff;
        }

        .sidik-input, .sidik-select {
            width: 100%;
            padding: 8px 10px;
            border: 2px solid var(--primary);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            -webkit-appearance: none;
        }

        .sidik-input:focus, .sidik-select:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 0 0 2px var(--primary);
        }

        .sidik-button {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(76, 201, 240, 0.4);
            width: 100%;
        }

        .sidik-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 201, 240, 0.6);
        }

        .sidik-datetime-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .sidik-datetime-control {
            flex: 1;
            min-width: 120px;
        }

        .sidik-use-current-time {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .sidik-use-current-time input {
            width: auto;
        }

        .sidik-results {
            display: none;
            margin-top: 15px;
        }

        .sidik-results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
        }

        .sidik-result-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
        }

        .sidik-result-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 8px 0;
            color: var(--primary);
        }

        .sidik-result-label {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .sidik-magic-square {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
            margin: 12px auto;
            max-width: 280px;
        }

        .sidik-square-cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            font-size: 1.1rem;
            font-weight: 700;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .sidik-square-cell.highlight {
            background: rgba(247, 37, 133, 0.3);
            border-color: var(--secondary);
            transform: scale(1.05);
        }

        .sidik-recommendations {
            margin-top: 15px;
        }

        .sidik-recommendation-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 6px;
            margin-top: 8px;
        }

        .sidik-recommendation-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 6px;
            border-radius: 6px;
            text-align: center;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }

        .sidik-recommendation-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
        }

        .sidik-analysis-text {
            margin-top: 10px;
            line-height: 1.5;
            opacity: 0.9;
            font-size: 0.8rem;
        }

        .sidik-loader {
            display: none;
            text-align: center;
            margin: 12px 0;
        }

        .sidik-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid var(--primary);
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        .sidik-datetime-factor {
            margin-top: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        .sidik-custom-keyboard {
            display: none;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
            margin-top: 8px;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 10px;
        }

        .sidik-keyboard-key {
            padding: 10px;
            background: rgba(255, 255, 255, 0.15);
            border: none;
            border-radius: 6px;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .sidik-keyboard-key:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .sidik-keyboard-key.clear {
            background: rgba(247, 37, 133, 0.7);
        }

        .sidik-keyboard-key.done {
            background: rgba(76, 201, 240, 0.7);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .keyboard {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.98);
            padding: 6px;
            display: none;
            grid-template-columns: repeat(4, 1fr);
            gap: 3px;
            z-index: 1000;
            border-radius: 10px 10px 0 0;
            max-height: 28vh;
            border-top: 1px solid var(--primary);
        }

        .keyboard.active {
            display: grid;
        }

        .key {
            padding: 8px 4px;
            background: var(--primary);
            border: none;
            border-radius: 4px;
            color: black;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            min-height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .key.clear {
            background: #e74c3c;
        }

        .key.submit {
            background: #27ae60;
        }

        .close-keyboard {
            position: absolute;
            top: -28px;
            right: 6px;
            background: rgba(0, 0, 0, 0.95);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 0.9rem;
            border: 1px solid var(--primary);
        }

        .period-third {
            display: none;
        }

        .risk-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            padding: 6px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: bold;
            margin-top: 4px;
        }

        .risk-low {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid #22c55e;
        }

        .risk-medium {
            background: rgba(234, 179, 8, 0.2);
            border: 1px solid #eab308;
        }

        .risk-high {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
        }

        /* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
        @media (max-height: 700px) {
            .header {
                padding: max(3px, env(safe-area-inset-top)) 6px 0;
            }
            
            .content {
                gap: 4px;
                padding: 0 6px 6px;
            }
            
            .period {
                padding: 4px;
            }
            
            .triangle-container {
                width: 150px;
                height: 150px;
            }
            
            .prediction-panel {
                padding: 8px;
                gap: 6px;
                margin-top: 6px;
            }
            
            .prediction-method {
                padding: 4px;
            }
            
            .trend-indicator {
                padding: 6px 10px;
                font-size: 0.8rem;
            }
            
            .magic-square {
                width: 200px;
                height: 200px;
            }
            
            .magic-cell {
                font-size: 1.1rem;
            }
            
            .magic-calculations {
                gap: 8px;
            }
            
            .calculation-group {
                padding: 8px;
            }
            
            .sidik-container {
                padding: 8px;
                gap: 10px;
            }
            
            .sidik-card {
                padding: 12px;
            }
            
            .sidik-card-title {
                font-size: 1rem;
                margin-bottom: 10px;
            }
            
            .sidik-input-group {
                gap: 8px;
                margin-bottom: 10px;
            }
            
            .sidik-input-field {
                min-width: 100px;
            }
            
            .sidik-magic-square {
                max-width: 240px;
            }
            
            .sidik-square-cell {
                font-size: 1rem;
            }
        }

        @media (max-height: 600px) {
            .triangle-container {
                width: 130px;
                height: 130px;
            }
            
            .prediction-panel h3 {
                font-size: 0.8rem;
            }
            
            .prediction-method h4 {
                font-size: 0.7rem;
            }
            
            .prediction-method .result {
                font-size: 0.7rem;
            }
            
            .magic-square {
                width: 180px;
                height: 180px;
            }
            
            .magic-cell {
                font-size: 1rem;
            }
            
            .magic-summary {
                padding: 8px;
            }
            
            .magic-result {
                padding: 8px;
                font-size: 1rem;
            }
            
            .sidik-container {
                padding: 6px;
                gap: 8px;
            }
            
            .sidik-card {
                padding: 10px;
            }
            
            .sidik-card-title {
                font-size: 0.9rem;
                margin-bottom: 8px;
            }
            
            .sidik-input-group {
                gap: 6px;
                margin-bottom: 8px;
            }
            
            .sidik-input-field {
                min-width: 90px;
            }
            
            .sidik-magic-square {
                max-width: 220px;
            }
            
            .sidik-square-cell {
                font-size: 0.9rem;
            }
        }

        @media (max-width: 350px) {
            .magic-calculations {
                grid-template-columns: 1fr;
            }
            
            .prediction-breakdown {
                grid-template-columns: 1fr;
            }
            
            .sidik-results-grid {
                grid-template-columns: 1fr;
            }
            
            .sidik-datetime-controls {
                flex-direction: column;
            }
            
            .sidik-datetime-control {
                min-width: 100%;
            }
        }
    </style>
</head>
<body class="theme-sun">
<div class="container">
    <div class="header">
        <div class="title-row">
            <h1>üèÄ –ö–∏–±–µ—Ä–±–∞—Å–∫–µ—Ç–±–æ–ª PRO</h1>
            <button class="basket-btn" onclick="clearAllData()" title="–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ">üèÄ</button>
        </div>
        <div class="tabs">
            <button class="tab active" onclick="setTab('calculator')">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</button>
            <button class="tab" onclick="setTab('visualization')">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
            <button class="tab" onclick="setTab('magic')">–ú–∞–≥–∏—á–µ—Å–∫–∏–π –∫–≤–∞–¥—Ä–∞—Ç</button>
            <button class="tab" onclick="setTab('sidik')">–°–∏–¥–∏–∫ –ê–≤–≥–∞–Ω</button>
        </div>
        <div class="mode-switcher">
            <button class="mode-btn active" onclick="setMode('two')">2 –ø–µ—Ä–∏–æ–¥–∞</button>
            <button class="mode-btn" onclick="setMode('three')">3 –ø–µ—Ä–∏–æ–¥–∞</button>
        </div>
        <div class="theme-switcher">
            <button class="theme-btn active" onclick="setTheme('sun')">‚òÄÔ∏è</button>
            <button class="theme-btn" onclick="setTheme('moon')">üåô</button>
            <button class="theme-btn" onclick="setTheme('fullmoon')">üåï</button>
            <button class="theme-btn" onclick="setTheme('newmoon')">üåë</button>
        </div>
    </div>
    <div class="content">
        <div class="tab-content active" id="calculator-tab">
            <div class="period">
                <h2>–ü–µ—Ä–≤—ã–π –ø–µ—Ä–∏–æ–¥</h2>
                <div class="teams-row">
                    <div class="team-input">
                        <label>–ö–æ–º–∞–Ω–¥–∞ 1</label>
                        <input type="text" class="score-input" id="team1-period1" value="0" readonly onclick="showKeyboard(this)">
                    </div>
                    <div class="vs-text">VS</div>
                    <div class="team-input">
                        <label>–ö–æ–º–∞–Ω–¥–∞ 2</label>
                        <input type="text" class="score-input" id="team2-period1" value="0" readonly onclick="showKeyboard(this)">
                    </div>
                </div>
            </div>
            <div class="period">
                <h2>–í—Ç–æ—Ä–æ–π –ø–µ—Ä–∏–æ–¥</h2>
                <div class="teams-row">
                    <div class="team-input">
                        <label>–ö–æ–º–∞–Ω–¥–∞ 1</label>
                        <input type="text" class="score-input" id="team1-period2" value="0" readonly onclick="showKeyboard(this)">
                    </div>
                    <div class="vs-text">VS</div>
                    <div class="team-input">
                        <label>–ö–æ–º–∞–Ω–¥–∞ 2</label>
                        <input type="text" class="score-input" id="team2-period2" value="0" readonly onclick="showKeyboard(this)">
                    </div>
                </div>
            </div>
            <div class="period period-third" id="third-period">
                <h2>–¢—Ä–µ—Ç–∏–π –ø–µ—Ä–∏–æ–¥</h2>
                <div class="teams-row">
                    <div class="team-input">
                        <label>–ö–æ–º–∞–Ω–¥–∞ 1</label>
                        <input type="text" class="score-input" id="team1-period3" value="0" readonly onclick="showKeyboard(this)">
                    </div>
                    <div class="vs-text">VS</div>
                    <div class="team-input">
                        <label>–ö–æ–º–∞–Ω–¥–∞ 2</label>
                        <input type="text" class="score-input" id="team2-period3" value="0" readonly onclick="showKeyboard(this)">
                    </div>
                </div>
            </div>
            <div id="result" class="result" style="display:none">
                –¢–æ—Ç–∞–ª: <strong><span id="totalValue">0</span></strong>
            </div>
            <div id="additionalResult" class="additional-result" style="display:none">
                –î–æ–ø. —Ä–∞—Å—á–µ—Ç: <strong><span id="additionalValue">0</span></strong>
            </div>
        </div>
        <div class="tab-content" id="visualization-tab">
            <div class="visualization-container">
                <h2>–ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–∞ —Ç–æ—Ç–∞–ª–∞</h2>
                <div class="triangle-container">
                    <svg class="triangle-svg" viewBox="0 0 300 300"></svg>
                </div>
                <div id="trendIndicator" class="trend-indicator">
                    <span id="trendIcon">‚ÜîÔ∏è</span>
                    <span id="trendText">–¢—Ä–µ–Ω–¥ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω</span>
                </div>
                
                <div class="prediction-panel">
                    <h3>–ü—Ä–æ–≥–Ω–æ–∑ –¥–ª—è —Å—Ç–∞–≤–æ–∫</h3>
                    
                    <div class="prediction-method">
                        <h4>–ú–µ—Ç–æ–¥ 1: –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ</h4>
                        <div class="result">–ü—Ä–æ–≥–Ω–æ–∑: <span id="expSmoothPrediction">-</span></div>
                        <div class="result">–¢–æ—á–Ω–æ—Å—Ç—å: <span id="expSmoothAccuracy">-</span></div>
                        <div class="confidence-meter">
                            <div id="expSmoothConfidence" class="confidence-fill" style="width:0%"></div>
                        </div>
                    </div>
                    
                    <div class="prediction-method">
                        <h4>–ú–µ—Ç–æ–¥ 2: –í–∑–≤–µ—à–µ–Ω–Ω–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è</h4>
                        <div class="result">–ü—Ä–æ–≥–Ω–æ–∑: <span id="weightedRegPrediction">-</span></div>
                        <div class="result">–î–æ–≤. –∏–Ω—Ç–µ—Ä–≤–∞–ª: <span id="weightedRegInterval">-</span></div>
                        <div class="confidence-meter">
                            <div id="weightedRegConfidence" class="confidence-fill" style="width:0%"></div>
                        </div>
                    </div>
                    
                    <div class="prediction-method">
                        <h4>–ú–µ—Ç–æ–¥ 3: –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º</h4>
                        <div class="result">–ü—Ä–æ–≥–Ω–æ–∑: <span id="adaptivePrediction">-</span></div>
                        <div class="result">–°–∏–≥–Ω–∞–ª: <span id="adaptiveSignal">-</span></div>
                        <div class="confidence-meter">
                            <div id="adaptiveConfidence" class="confidence-fill" style="width:0%"></div>
                        </div>
                    </div>
                    
                    <div id="riskIndicator" class="risk-indicator risk-medium">
                        <span id="riskIcon">‚ö†Ô∏è</span>
                        <span id="riskText">–£–º–µ—Ä–µ–Ω–Ω—ã–π —Ä–∏—Å–∫</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="magic-tab">
            <div class="magic-square-container">
                <h2>üîÆ –ú–∞–≥–∏—á–µ—Å–∫–∏–π –∫–≤–∞–¥—Ä–∞—Ç –°–∏–¥–∏–∫–∞ –ê–≤–≥–∞–Ω–∞</h2>
                
                <div class="magic-explanation">
                    –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –±–∞—Å–∫–µ—Ç–±–æ–ª—å–Ω—ã—Ö –ø–µ—Ä–∏–æ–¥–æ–≤ –≤ –Ω—É–º–µ—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫—É—é –º–∞—Ç—Ä–∏—Ü—É –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è
                </div>
                
                <div class="magic-square" id="magicSquare">
                    <!-- –Ø—á–µ–π–∫–∏ –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è JavaScript -->
                </div>
                
                <div class="magic-calculations">
                    <div class="calculation-group">
                        <div class="calculation-title">üìä –û—Å–Ω–æ–≤–Ω—ã–µ —Å—É–º–º—ã</div>
                        <div class="calculation-item">
                            <span>–ú–∞–≥–∏—á–µ—Å–∫–∞—è —Å—É–º–º–∞:</span>
                            <span class="calculation-value" id="magicSumTotal">0</span>
                        </div>
                        <div class="calculation-item">
                            <span>–°—Ç—Ä–æ–∫–∞ 1:</span>
                            <span class="calculation-value" id="row1Sum">0</span>
                        </div>
                        <div class="calculation-item">
                            <span>–°—Ç—Ä–æ–∫–∞ 2:</span>
                            <span class="calculation-value" id="row2Sum">0</span>
                        </div>
                        <div class="calculation-item">
                            <span>–°—Ç—Ä–æ–∫–∞ 3:</span>
                            <span class="calculation-value" id="row3Sum">0</span>
                        </div>
                        <div class="calculation-formula">–°—É–º–º—ã –ø–æ —Å—Ç—Ä–æ–∫–∞–º</div>
                    </div>
                    
                    <div class="calculation-group diagonal">
                        <div class="calculation-title diagonal">üéØ –î–∏–∞–≥–æ–Ω–∞–ª–∏ —Å–∏–ª—ã</div>
                        <div class="calculation-item">
                            <span>–ì–ª–∞–≤–Ω–∞—è (‚Üò):</span>
                            <span class="calculation-value diagonal" id="mainDiagonalSum">0</span>
                        </div>
                        <div class="calculation-item">
                            <span>–ü–æ–±–æ—á–Ω–∞—è (‚Üô):</span>
                            <span class="calculation-value diagonal" id="antiDiagonalSum">0</span>
                        </div>
                        <div class="calculation-item">
                            <span>–ë–∞–ª–∞–Ω—Å:</span>
                            <span class="calculation-value diagonal" id="diagonalBalance">0</span>
                        </div>
                        <div class="calculation-item">
                            <span>–≠–Ω–µ—Ä–≥–∏—è:</span>
                            <span class="calculation-value diagonal" id="diagonalEnergy">0</span>
                        </div>
                        <div class="calculation-formula">(–ì–ª. + –ü–æ–±.) / 2</div>
                    </div>
                </div>

                <div class="magic-summary">
                    <div class="summary-title">üìà –ê–Ω–∞–ª–∏–∑ —ç–Ω–µ—Ä–≥–∏–∏</div>
                    <div class="summary-item">
                        <span class="summary-label">–ê–∫—Ç–∏–≤–Ω—ã–µ —è—á–µ–π–∫–∏:</span>
                        <span class="summary-value" id="activeCells">0/9</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">–°–∏–ª–∞ —Ü–µ–Ω—Ç—Ä–∞:</span>
                        <span class="summary-value" id="centerPower">0</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">–≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å:</span>
                        <span class="summary-value" id="energyLevel">–ù–∏–∑–∫–∏–π</span>
                    </div>
                    <div class="energy-level">
                        <span style="font-size: 0.7rem;">–≠–Ω–µ—Ä–≥–∏—è:</span>
                        <div class="energy-bar">
                            <div class="energy-fill" id="energyFill"></div>
                        </div>
                    </div>
                </div>

                <div class="interpretation">
                    <div class="interpretation-title">üí° –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –º–∞—Ç—Ä–∏—Ü—ã</div>
                    <div class="interpretation-text" id="magicInterpretation">
                        –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–∏–æ–¥–æ–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞...
                    </div>
                </div>

                <div class="magic-result" id="magicResult" style="display:none">
                    <div>‚ú® –ú–∞–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–≥–Ω–æ–∑: <strong><span id="magicPrediction">0</span></strong></div>
                    <div class="prediction-breakdown">
                        <div class="breakdown-item">
                            <div>–ë–∞–∑–∞</div>
                            <div class="breakdown-value" id="basePrediction">0</div>
                        </div>
                        <div class="breakdown-item">
                            <div>–ö–æ—Ä—Ä–µ–∫—Ü–∏—è</div>
                            <div class="breakdown-value" id="correctionValue">0</div>
                        </div>
                        <div class="breakdown-item">
                            <div>–≠–Ω–µ—Ä–≥–∏—è</div>
                            <div class="breakdown-value" id="energyValue">0%</div>
                        </div>
                        <div class="breakdown-item">
                            <div>–¢—Ä–µ–Ω–¥</div>
                            <div class="breakdown-value" id="trendValue">1.0x</div>
                        </div>
                    </div>
                </div>

                <div class="magic-legend">
                    <div class="legend-item">
                        <div class="legend-color legend-primary"></div>
                        <span>–ê–∫—Ç–∏–≤–Ω—ã–µ —è—á–µ–π–∫–∏</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color legend-secondary"></div>
                        <span>–î–∏–∞–≥–æ–Ω–∞–ª—å —Å–∏–ª—ã</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color legend-corner"></div>
                        <span>–£–≥–ª–æ–≤—ã–µ —è—á–µ–π–∫–∏</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ù–æ–≤–∞—è –≤–∫–ª–∞–¥–∫–∞ –°–∏–¥–∏–∫–∞ –ê–≤–≥–∞–Ω–∞ -->
        <div class="tab-content" id="sidik-tab">
            <div class="sidik-container">
                <div class="sidik-card">
                    <h2 class="sidik-card-title">
                        <i>üìä</i> –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∞
                    </h2>
                    
                    <div class="sidik-use-current-time">
                        <input type="checkbox" id="sidik-useCurrentTime" checked>
                        <label for="sidik-useCurrentTime">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–µ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è</label>
                    </div>
                    
                    <div class="sidik-datetime-controls" id="sidik-datetimeControls" style="display: none;">
                        <div class="sidik-datetime-control">
                            <label for="sidik-customDate">–î–∞—Ç–∞</label>
                            <input type="date" id="sidik-customDate" class="sidik-input">
                        </div>
                        <div class="sidik-datetime-control">
                            <label for="sidik-customTime">–í—Ä–µ–º—è</label>
                            <input type="time" id="sidik-customTime" class="sidik-input">
                        </div>
                        <div class="sidik-datetime-control">
                            <label for="sidik-timezone">–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å</label>
                            <select id="sidik-timezone" class="sidik-select">
                                <option value="0">UTC</option>
                                <option value="3" selected>–ú–æ—Å–∫–≤–∞ (+3)</option>
                                <option value="1">–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥ (+1)</option>
                                <option value="4">–°–∞–º–∞—Ä–∞ (+4)</option>
                                <option value="5">–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥ (+5)</option>
                                <option value="7">–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫ (+7)</option>
                                <option value="8">–ò—Ä–∫—É—Ç—Å–∫ (+8)</option>
                                <option value="9">–Ø–∫—É—Ç—Å–∫ (+9)</option>
                                <option value="10">–í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫ (+10)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="sidik-input-group">
                        <div class="sidik-input-field">
                            <label for="sidik-period1">–ü–µ—Ä–∏–æ–¥ 1</label>
                            <input type="number" id="sidik-period1" class="sidik-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ" min="1" onclick="showSidikKeyboard(this)">
                        </div>
                        <div class="sidik-input-field">
                            <label for="sidik-period2">–ü–µ—Ä–∏–æ–¥ 2</label>
                            <input type="number" id="sidik-period2" class="sidik-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ" min="1" onclick="showSidikKeyboard(this)">
                        </div>
                        <div class="sidik-input-field">
                            <label for="sidik-period3">–ü–µ—Ä–∏–æ–¥ 3</label>
                            <input type="number" id="sidik-period3" class="sidik-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ" min="1" onclick="showSidikKeyboard(this)">
                        </div>
                    </div>
                    
                    <div class="sidik-custom-keyboard" id="sidik-customKeyboard">
                        <button class="sidik-keyboard-key" data-value="1">1</button>
                        <button class="sidik-keyboard-key" data-value="2">2</button>
                        <button class="sidik-keyboard-key" data-value="3">3</button>
                        <button class="sidik-keyboard-key" data-value="4">4</button>
                        <button class="sidik-keyboard-key" data-value="5">5</button>
                        <button class="sidik-keyboard-key" data-value="6">6</button>
                        <button class="sidik-keyboard-key" data-value="7">7</button>
                        <button class="sidik-keyboard-key" data-value="8">8</button>
                        <button class="sidik-keyboard-key" data-value="9">9</button>
                        <button class="sidik-keyboard-key clear">–û—á–∏—Å—Ç–∏—Ç—å</button>
                        <button class="sidik-keyboard-key" data-value="0">0</button>
                        <button class="sidik-keyboard-key done">–ì–æ—Ç–æ–≤–æ</button>
                    </div>
                    
                    <button id="sidik-calculateBtn" class="sidik-button">
                        <i>üîÆ</i> –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø—Ä–æ–≥–Ω–æ–∑
                    </button>
                </div>
                
                <div class="sidik-loader" id="sidik-loader">
                    <div class="sidik-spinner"></div>
                    <p>–í—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –º–∞–≥–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å—á–µ—Ç—ã...</p>
                </div>
                
                <div class="sidik-results" id="sidik-results">
                    <div class="sidik-card">
                        <h2 class="sidik-card-title">
                            <i>‚ú®</i> –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≥–Ω–æ–∑–∞
                        </h2>
                        <div class="sidik-results-grid">
                            <div class="sidik-result-card">
                                <div class="sidik-result-label">–ß–µ—Ç–≤–µ—Ä—Ç—ã–π –ø–µ—Ä–∏–æ–¥</div>
                                <div class="sidik-result-value" id="sidik-period4Result">-</div>
                                <div class="sidik-result-label">–ù—É–º–µ—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∫–æ—Ä–µ–Ω—å: <span id="sidik-period4Root">-</span></div>
                            </div>
                            <div class="sidik-result-card">
                                <div class="sidik-result-label">–û–±—â–∏–π —Ç–æ—Ç–∞–ª</div>
                                <div class="sidik-result-value" id="sidik-totalResult">-</div>
                                <div class="sidik-result-label">–ù—É–º–µ—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∫–æ—Ä–µ–Ω—å: <span id="sidik-totalRoot">-</span></div>
                            </div>
                            <div class="sidik-result-card">
                                <div class="sidik-result-label">–§–∞–∫—Ç–æ—Ä –¥–∞—Ç—ã/–≤—Ä–µ–º–µ–Ω–∏</div>
                                <div class="sidik-result-value" id="sidik-datetimeFactor">-</div>
                                <div class="sidik-result-label">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: <span id="sidik-datetimeUsed">-</span></div>
                            </div>
                        </div>
                        
                        <div class="sidik-datetime-factor">
                            <h3>–í–ª–∏—è–Ω–∏–µ –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –ø—Ä–æ–≥–Ω–æ–∑:</h3>
                            <p id="sidik-datetimeAnalysis">-</p>
                        </div>
                    </div>
                    
                    <div class="sidik-card">
                        <h2 class="sidik-card-title">
                            <i>üßä</i> –ú–∞–≥–∏—á–µ—Å–∫–∏–π –∫–≤–∞–¥—Ä–∞—Ç –°–∏–¥–∏–∫–∞ –ê–≤–≥–∞–Ω–∞
                        </h2>
                        <div class="sidik-magic-square" id="sidik-magicSquare">
                            <!-- –ö–≤–∞–¥—Ä–∞—Ç –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω JavaScript -->
                        </div>
                    </div>
                    
                    <div class="sidik-card sidik-recommendations">
                        <h2 class="sidik-card-title">
                            <i>üéØ</i> –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Å—Ç–∞–≤–æ–∫
                        </h2>
                        <div>
                            <h3>–ß–µ—Ç–≤–µ—Ä—Ç—ã–π –ø–µ—Ä–∏–æ–¥ (–∫–æ—Ä–µ–Ω—å: <span id="sidik-recPeriodRoot">-</span>)</h3>
                            <div class="sidik-recommendation-list" id="sidik-periodRecommendations">
                                <!-- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã JavaScript -->
                            </div>
                        </div>
                        <div style="margin-top: 15px;">
                            <h3>–û–±—â–∏–π —Ç–æ—Ç–∞–ª (–∫–æ—Ä–µ–Ω—å: <span id="sidik-recTotalRoot">-</span>)</h3>
                            <div class="sidik-recommendation-list" id="sidik-totalRecommendations">
                                <!-- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã JavaScript -->
                            </div>
                        </div>
                        <div class="sidik-analysis-text" id="sidik-analysisText">
                            <!-- –ê–Ω–∞–ª–∏–∑ –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="keyboard" id="keyboard">
    <button class="close-keyboard" onclick="hideKeyboard()">√ó</button>
    <button class="key" onclick="pressKey('1')">1</button>
    <button class="key" onclick="pressKey('2')">2</button>
    <button class="key" onclick="pressKey('3')">3</button>
    <button class="key" onclick="pressKey('4')">4</button>
    <button class="key" onclick="pressKey('5')">5</button>
    <button class="key" onclick="pressKey('6')">6</button>
    <button class="key" onclick="pressKey('7')">7</button>
    <button class="key" onclick="pressKey('8')">8</button>
    <button class="key" onclick="pressKey('9')">9</button>
    <button class="key" onclick="pressKey('0')">0</button>
    <button class="key clear" onclick="clearInput()">C</button>
    <button class="key submit" onclick="hideKeyboardWithCalculation()">‚úì</button>
</div>

<script>
// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let currentInput = null;
let currentMode = 'two';
let currentTab = 'calculator';
let sidikCurrentInput = null;

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∞–º–∏
function setTab(tab) {
    currentTab = tab;
    document.querySelectorAll('.tab').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
    });
    document.getElementById(`${tab}-tab`).classList.add('active');
    
    if (tab === 'visualization') {
        updateVisualization();
    } else if (tab === 'magic') {
        updateMagicSquare();
    } else if (tab === 'sidik') {
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª–∞–¥–∫–∏ –°–∏–¥–∏–∫–∞ –ê–≤–≥–∞–Ω–∞
        updateSidikCurrentDateTime();
        // –°–∫—Ä—ã—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∫–ª–∞–¥–æ–∫
        document.getElementById('sidik-customKeyboard').style.display = 'none';
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ä–∞—Å—á–µ—Ç–æ–≤ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É –°–∏–¥–∏–∫–∞ –ê–≤–≥–∞–Ω–∞
        autoCalculateSidik();
    }
}

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞–º–∏
function setMode(mode) {
    currentMode = mode;
    document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    const thirdPeriod = document.getElementById('third-period');
    const additionalResult = document.getElementById('additionalResult');
    
    if (mode === 'three') {
        thirdPeriod.style.display = 'block';
        additionalResult.style.display = 'none';
    } else {
        thirdPeriod.style.display = 'none';
        additionalResult.style.display = 'none';
    }
    
    document.getElementById('result').style.display = 'none';
    
    if (currentTab === 'visualization') {
        updateVisualization();
    } else if (currentTab === 'magic') {
        updateMagicSquare();
    }
    
    // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–µ–∂–∏–º–∞ –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –°–∏–¥–∏–∫ –ê–≤–≥–∞–Ω–µ
    updateSidikFromCalculator();
}

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–º–∞–º–∏
function setTheme(theme) {
    document.body.className = `theme-${theme}`;
    document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    localStorage.setItem('selectedTheme', theme);
}

// –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
function clearAllData() {
    document.querySelectorAll('.score-input').forEach(input => {
        input.value = '0';
    });
    
    document.getElementById('result').style.display = 'none';
    document.getElementById('additionalResult').style.display = 'none';
    document.getElementById('magicResult').style.display = 'none';
    
    hideKeyboard();
    
    if (currentTab === 'visualization') {
        updateVisualization();
    } else if (currentTab === 'magic') {
        updateMagicSquare();
    }
    
    // –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –°–∏–¥–∏–∫ –ê–≤–≥–∞–Ω–µ
    updateSidikFromCalculator();
    
    showClearNotification();
}

function showClearNotification() {
    const notification = document.createElement('div');
    notification.textContent = '–î–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã!';
    notification.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.9);
        color: white;
        padding: 8px 16px;
        border-radius: 6px;
        border: 2px solid var(--primary);
        z-index: 1001;
        font-size: 0.9rem;
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        document.body.removeChild(notification);
    }, 1500);
}

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π
function showKeyboard(input) {
    currentInput = input;
    const keyboard = document.getElementById('keyboard');
    keyboard.classList.add('active');
    input.blur();
    
    setTimeout(() => {
        input.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }, 100);
}

function hideKeyboard() {
    document.getElementById('keyboard').classList.remove('active');
    currentInput = null;
}

function hideKeyboardWithCalculation() {
    hideKeyboard();
    calculateTotal();
    if (currentTab === 'visualization') {
        updateVisualization();
    } else if (currentTab === 'magic') {
        updateMagicSquare();
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –°–∏–¥–∏–∫ –ê–≤–≥–∞–Ω–µ –ø–æ—Å–ª–µ –≤–≤–æ–¥–∞
    updateSidikFromCalculator();
}

function pressKey(key) {
    if (currentInput) {
        const currentValue = currentInput.value;
        currentInput.value = currentValue === '0' ? key : currentValue + key;
    }
}

function clearInput() {
    if (currentInput) currentInput.value = '0';
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
document.addEventListener('click', function(event) {
    const keyboard = document.getElementById('keyboard');
    const scoreInputs = document.querySelectorAll('.score-input');
    if (!keyboard.contains(event.target) && !Array.from(scoreInputs).some(input => input.contains(event.target))) {
        hideKeyboard();
    }
});

document.querySelectorAll('.score-input').forEach(input => {
    input.addEventListener('focus', function(e) {
        e.preventDefault();
        this.blur();
    });
    
    input.addEventListener('input', function() {
        if (currentTab === 'visualization') {
            updateVisualization();
        } else if (currentTab === 'magic') {
            updateMagicSquare();
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –°–∏–¥–∏–∫ –ê–≤–≥–∞–Ω–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–µ
        updateSidikFromCalculator();
    });
});

// –û—Å–Ω–æ–≤–Ω–æ–π —Ä–∞—Å—á–µ—Ç
function calculateTotal() {
    let total;
    let additionalTotal = null;
    
    if (currentMode === 'two') {
        const team1p1 = parseInt(document.getElementById('team1-period1').value) || 0;
        const team2p1 = parseInt(document.getElementById('team2-period1').value) || 0;
        const team1p2 = parseInt(document.getElementById('team1-period2').value) || 0;
        const team2p2 = parseInt(document.getElementById('team2-period2').value) || 0;

        const totalFirstPeriod = team1p1 + team2p1;
        const totalSecondPeriod = team1p2 + team2p2;
        
        total = (totalFirstPeriod + totalSecondPeriod) * 2;

        if (totalFirstPeriod > totalSecondPeriod) {
            total += (totalFirstPeriod - totalSecondPeriod);
        } else {
            total -= (totalSecondPeriod - totalFirstPeriod);
        }
    } else {
        const team1p1 = parseInt(document.getElementById('team1-period1').value) || 0;
        const team2p1 = parseInt(document.getElementById('team2-period1').value) || 0;
        const team1p2 = parseInt(document.getElementById('team1-period2').value) || 0;
        const team2p2 = parseInt(document.getElementById('team2-period2').value) || 0;
        const team1p3 = parseInt(document.getElementById('team1-period3').value) || 0;
        const team2p3 = parseInt(document.getElementById('team2-period3').value) || 0;

        const totalFirstPeriod = team1p1 + team2p1;
        const totalSecondPeriod = team1p2 + team2p2;
        const totalThirdPeriod = team1p3 + team2p3;
        
        total = (totalFirstPeriod + totalSecondPeriod + totalThirdPeriod) * (4/3);
        
        if (totalThirdPeriod > totalSecondPeriod) {
            total += (totalThirdPeriod - totalSecondPeriod);
        } else {
            total -= (totalSecondPeriod - totalThirdPeriod);
        }
        
        total = Math.round(total);

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
        const twoPeriodTotal = (totalFirstPeriod + totalSecondPeriod) * 2;
        const diffTwoPeriods = Math.abs(totalFirstPeriod - totalSecondPeriod);
        
        let adjustedTwoPeriodTotal = twoPeriodTotal;
        if (totalFirstPeriod > totalSecondPeriod) {
            adjustedTwoPeriodTotal += diffTwoPeriods;
        } else {
            adjustedTwoPeriodTotal -= diffTwoPeriods;
        }

        additionalTotal = Math.round((total + adjustedTwoPeriodTotal) / 2);
    }

    document.getElementById('totalValue').textContent = total;
    document.getElementById('result').style.display = 'block';
    
    if (currentMode === 'three' && additionalTotal !== null) {
        document.getElementById('additionalValue').textContent = additionalTotal;
        document.getElementById('additionalResult').style.display = 'block';
    } else {
        document.getElementById('additionalResult').style.display = 'none';
    }
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç
document.querySelectorAll('.score-input').forEach(input => {
    input.addEventListener('input', function() {
        let allFilled = true;
        const requiredFields = currentMode === 'two' 
            ? ['team1-period1', 'team2-period1', 'team1-period2', 'team2-period2']
            : ['team1-period1', 'team2-period1', 'team1-period2', 'team2-period2', 'team1-period3', 'team2-period3'];
        
        for (let fieldId of requiredFields) {
            const field = document.getElementById(fieldId);
            if (!field.value || field.value === '0') {
                allFilled = false;
                break;
            }
        }
        
        if (allFilled) {
            calculateTotal();
            if (currentTab === 'visualization') {
                updateVisualization();
            } else if (currentTab === 'magic') {
                updateMagicSquare();
            }
        }
    });
});

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –≤ –°–∏–¥–∏–∫ –ê–≤–≥–∞–Ω
function updateSidikFromCalculator() {
    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    const team1p1 = parseInt(document.getElementById('team1-period1').value) || 0;
    const team2p1 = parseInt(document.getElementById('team2-period1').value) || 0;
    const team1p2 = parseInt(document.getElementById('team1-period2').value) || 0;
    const team2p2 = parseInt(document.getElementById('team2-period2').value) || 0;
    const team1p3 = parseInt(document.getElementById('team1-period3').value) || 0;
    const team2p3 = parseInt(document.getElementById('team2-period3').value) || 0;
    
    // –í—ã—á–∏—Å–ª—è–µ–º —Ç–æ—Ç–∞–ª—ã –ø–µ—Ä–∏–æ–¥–æ–≤ (—Å—É–º–º–∞ –æ—á–∫–æ–≤ –¥–≤—É—Ö –∫–æ–º–∞–Ω–¥)
    const totalPeriod1 = team1p1 + team2p1;
    const totalPeriod2 = team1p2 + team2p2;
    const totalPeriod3 = team1p3 + team2p3;
    
    // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –ø–æ–ª—è –°–∏–¥–∏–∫–∞ –ê–≤–≥–∞–Ω–∞
    document.getElementById('sidik-period1').value = totalPeriod1;
    document.getElementById('sidik-period2').value = totalPeriod2;
    
    // –î–ª—è —Ç—Ä–µ—Ç—å–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ —É—á–∏—Ç—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º
    if (currentMode === 'three') {
        document.getElementById('sidik-period3').value = totalPeriod3;
    } else {
        // –í —Ä–µ–∂–∏–º–µ –¥–≤—É—Ö –ø–µ—Ä–∏–æ–¥–æ–≤ —Ç—Ä–µ—Ç–∏–π –ø–µ—Ä–∏–æ–¥ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
        document.getElementById('sidik-period3').value = 0;
    }
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Ä–∞—Å—á–µ—Ç—ã, –µ—Å–ª–∏ –µ—Å—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö
    autoCalculateSidik();
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –°–∏–¥–∏–∫–∞ –ê–≤–≥–∞–Ω–∞
function autoCalculateSidik() {
    const period1 = parseInt(document.getElementById('sidik-period1').value) || 0;
    const period2 = parseInt(document.getElementById('sidik-period2').value) || 0;
    const period3 = parseInt(document.getElementById('sidik-period3').value) || 0;
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞
    let enoughData = false;
    if (currentMode === 'two') {
        enoughData = period1 > 0 && period2 > 0;
    } else {
        enoughData = period1 > 0 && period2 > 0 && period3 > 0;
    }
    
    // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Ä–∞—Å—á–µ—Ç—ã
    if (enoughData) {
        calculateSidikPredictions();
    }
}

// –ê–ª–≥–æ—Ä–∏—Ç–º—ã –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è
function exponentialSmoothing(data, alpha = 0.7) {
    if (data.length < 2) return { prediction: 0, accuracy: 0 };
    
    let smoothed = data[0];
    let mae = 0;
    
    for (let i = 1; i < data.length; i++) {
        const error = Math.abs(data[i] - smoothed);
        mae += error;
        smoothed = alpha * data[i] + (1 - alpha) * smoothed;
    }
    
    mae = mae / (data.length - 1);
    const accuracy = Math.max(0, 100 - (mae / (Math.max(...data) || 1)) * 100);
    
    return { prediction: Math.round(smoothed), accuracy: Math.round(accuracy) };
}

function weightedRegression(data) {
    if (data.length < 2) return { prediction: 0, interval: [0, 0], confidence: 0 };
    
    const n = data.length;
    const weights = data.map((_, i) => Math.pow(1.5, i));
    
    let sumX = 0, sumY = 0, sumXY = 0, sumX2 = 0, sumW = 0;
    
    for (let i = 0; i < n; i++) {
        const x = i + 1;
        const y = data[i];
        const w = weights[i];
        
        sumX += x * w;
        sumY += y * w;
        sumXY += x * y * w;
        sumX2 += x * x * w;
        sumW += w;
    }
    
    const slope = (sumW * sumXY - sumX * sumY) / (sumW * sumX2 - sumX * sumX);
    const intercept = (sumY - slope * sumX) / sumW;
    
    const nextX = n + 1;
    const prediction = slope * nextX + intercept;
    
    let variance = 0;
    for (let i = 0; i < n; i++) {
        const x = i + 1;
        const y = data[i];
        const predicted = slope * x + intercept;
        variance += Math.pow(y - predicted, 2) * weights[i];
    }
    
    const stdError = Math.sqrt(variance / (n - 2));
    const margin = 1.96 * stdError * Math.sqrt(1 + 1/n);
    
    const confidence = Math.max(0, 100 - (stdError / (Math.max(...data) || 1)) * 150);
    
    return {
        prediction: Math.round(prediction),
        interval: [Math.round(prediction - margin), Math.round(prediction + margin)],
        confidence: Math.round(confidence)
    };
}

function adaptivePrediction(data) {
    if (data.length < 2) return { prediction: 0, signal: "–ù–ï–¢ –î–ê–ù–ù–´–•", confidence: 0 };
    
    const trends = [];
    for (let i = 1; i < data.length; i++) {
        trends.push(data[i] - data[i-1]);
    }
    
    const avgTrend = trends.reduce((a, b) => a + b, 0) / trends.length;
    const volatility = Math.sqrt(trends.reduce((a, b) => a + Math.pow(b - avgTrend, 2), 0) / trends.length);
    
    let prediction;
    let signal;
    
    if (volatility < 5) {
        prediction = data.reduce((a, b) => a + b, 0) / data.length;
        signal = "–°–¢–ê–ë–ò–õ–¨–ù–û";
    } else if (Math.abs(avgTrend) > 8) {
        prediction = data[data.length - 1] + avgTrend;
        signal = avgTrend > 0 ? "üìà –†–û–°–¢" : "üìâ –ü–ê–î–ï–ù–ò–ï";
    } else {
        const weights = data.map((_, i) => i + 1);
        const weightedSum = data.reduce((sum, val, i) => sum + val * weights[i], 0);
        prediction = weightedSum / weights.reduce((a, b) => a + b, 0);
        signal = "‚è∏Ô∏è –§–õ–≠–¢";
    }
    
    const confidence = Math.max(0, 100 - volatility * 3);
    
    return {
        prediction: Math.round(prediction),
        signal: signal,
        confidence: Math.round(confidence)
    };
}

function calculateRiskLevel(data) {
    if (data.length < 2) return { level: "medium", text: "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö", icon: "‚ö†Ô∏è" };
    
    const volatility = Math.sqrt(
        data.slice(1).reduce((sum, val, i) => sum + Math.pow(val - data[i], 2), 0) / (data.length - 1)
    );
    
    const avgValue = data.reduce((a, b) => a + b, 0) / data.length;
    const cv = (volatility / avgValue) * 100;
    
    if (cv < 15) return { level: "low", text: "–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫", icon: "‚úÖ" };
    if (cv < 30) return { level: "medium", text: "–£–º–µ—Ä–µ–Ω–Ω—ã–π —Ä–∏—Å–∫", icon: "‚ö†Ô∏è" };
    return { level: "high", text: "–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫", icon: "üö®" };
}

// –ú–∞–≥–∏—á–µ—Å–∫–∏–π –∫–≤–∞–¥—Ä–∞—Ç –°–∏–¥–∏–∫–∞ –ê–≤–≥–∞–Ω–∞ - –û–ë–ù–û–í–õ–ï–ù–ù–´–ï –§–£–ù–ö–¶–ò–ò
function updateMagicSquare() {
    const magicSquare = document.getElementById('magicSquare');
    magicSquare.innerHTML = '';
    
    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–∏–æ–¥–æ–≤
    const team1p1 = parseInt(document.getElementById('team1-period1').value) || 0;
    const team2p1 = parseInt(document.getElementById('team2-period1').value) || 0;
    const team1p2 = parseInt(document.getElementById('team1-period2').value) || 0;
    const team2p2 = parseInt(document.getElementById('team2-period2').value) || 0;
    const team1p3 = parseInt(document.getElementById('team1-period3').value) || 0;
    const team2p3 = parseInt(document.getElementById('team2-period3').value) || 0;
    
    const totalFirstPeriod = team1p1 + team2p1;
    const totalSecondPeriod = team1p2 + team2p2;
    const totalThirdPeriod = team1p3 + team2p3;
    
    // –°–æ–∑–¥–∞–µ–º –º–∞–≥–∏—á–µ—Å–∫–∏–π –∫–≤–∞–¥—Ä–∞—Ç 3x3
    const magicValues = createMagicSquare(totalFirstPeriod, totalSecondPeriod, totalThirdPeriod);
    
    // –ó–∞–ø–æ–ª–Ω—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
    for (let i = 0; i < 9; i++) {
        const cell = document.createElement('div');
        cell.className = 'magic-cell';
        cell.innerHTML = `<span class="cell-index">${i+1}</span>${magicValues[i]}`;
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —è—á–µ–π–∫–∏
        if (i === 0 || i === 2 || i === 6 || i === 8) {
            cell.classList.add('corner');
        }
        if (i === 4) {
            cell.classList.add('center');
        }
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–∏–∞–≥–æ–Ω–∞–ª—å–Ω—ã–µ —è—á–µ–π–∫–∏
        if (i === 0 || i === 4 || i === 8) { // –ì–ª–∞–≤–Ω–∞—è –¥–∏–∞–≥–æ–Ω–∞–ª—å
            cell.classList.add('diagonal');
        }
        if (i === 2 || i === 4 || i === 6) { // –ü–æ–±–æ—á–Ω–∞—è –¥–∏–∞–≥–æ–Ω–∞–ª—å
            cell.classList.add('diagonal');
        }
        
        // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —è—á–µ–π–∫–∏ (–Ω–µ–Ω—É–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è)
        if (magicValues[i] > 0) {
            cell.classList.add('active');
        }
        
        magicSquare.appendChild(cell);
    }
    
    // –í—ã—á–∏—Å–ª—è–µ–º –≤—Å–µ —Å—É–º–º—ã –∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
    const calculations = calculateAllMagicValues(magicValues, totalFirstPeriod, totalSecondPeriod, totalThirdPeriod);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    updateMagicUI(calculations, magicValues);
}

function createMagicSquare(p1, p2, p3) {
    // –ë–∞–∑–æ–≤—ã–π –º–∞–≥–∏—á–µ—Å–∫–∏–π –∫–≤–∞–¥—Ä–∞—Ç –õ–æ –®—É
    const baseSquare = [4, 9, 2, 3, 5, 7, 8, 1, 6];
    
    // –ê–¥–∞–ø—Ç–∏—Ä—É–µ–º –∫–≤–∞–¥—Ä–∞—Ç –ø–æ–¥ –Ω–∞—à–∏ –¥–∞–Ω–Ω—ã–µ —Å —Ä–∞–∑–Ω—ã–º–∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞–º–∏
    const adaptedSquare = baseSquare.map((value, index) => {
        let multiplier;
        
        // –†–∞–∑–Ω—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏
        switch(index) {
            case 0: multiplier = p1 / 15; break; // –õ–µ–≤—ã–π –≤–µ—Ä—Ö - –ø–µ—Ä–≤—ã–π –ø–µ—Ä–∏–æ–¥
            case 1: multiplier = p2 / 12; break; // –í–µ—Ä—Ö–Ω–∏–π —Ü–µ–Ω—Ç—Ä - –≤—Ç–æ—Ä–æ–π –ø–µ—Ä–∏–æ–¥  
            case 2: multiplier = p3 / 15; break; // –ü—Ä–∞–≤—ã–π –≤–µ—Ä—Ö - —Ç—Ä–µ—Ç–∏–π –ø–µ—Ä–∏–æ–¥
            case 3: multiplier = (p1 + p2) / 25; break; // –õ–µ–≤—ã–π —Ü–µ–Ω—Ç—Ä
            case 4: multiplier = (p1 + p2 + p3) / 35; break; // –¶–µ–Ω—Ç—Ä - –æ–±—â–∞—è —ç–Ω–µ—Ä–≥–∏—è
            case 5: multiplier = (p2 + p3) / 25; break; // –ü—Ä–∞–≤—ã–π —Ü–µ–Ω—Ç—Ä
            case 6: multiplier = p3 / 15; break; // –õ–µ–≤—ã–π –Ω–∏–∑
            case 7: multiplier = p1 / 12; break; // –ù–∏–∂–Ω–∏–π —Ü–µ–Ω—Ç—Ä
            case 8: multiplier = p2 / 15; break; // –ü—Ä–∞–≤—ã–π –Ω–∏–∑
            default: multiplier = 1;
        }
        
        return Math.max(0, Math.round(value * multiplier));
    });
    
    return adaptedSquare;
}

function calculateAllMagicValues(magicValues, p1, p2, p3) {
    // –°—É–º–º—ã —Å—Ç—Ä–æ–∫
    const row1 = magicValues[0] + magicValues[1] + magicValues[2];
    const row2 = magicValues[3] + magicValues[4] + magicValues[5]; 
    const row3 = magicValues[6] + magicValues[7] + magicValues[8];
    
    // –°—É–º–º—ã –¥–∏–∞–≥–æ–Ω–∞–ª–µ–π
    const mainDiagonal = magicValues[0] + magicValues[4] + magicValues[8];
    const antiDiagonal = magicValues[2] + magicValues[4] + magicValues[6];
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
    const magicSumTotal = row1; // –¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ —Å—É–º–º–∞ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–∏
    const diagonalBalance = mainDiagonal - antiDiagonal;
    const diagonalEnergy = (mainDiagonal + antiDiagonal) / 2;
    const centerPower = magicValues[4];
    const activeCells = magicValues.filter(val => val > 0).length;
    
    // –†–∞—Å—á–µ—Ç —ç–Ω–µ—Ä–≥–∏–∏
    const totalEnergy = magicValues.reduce((a, b) => a + b, 0);
    const maxEnergy = 9 * 15; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è
    const energyPercent = Math.min(100, Math.round((totalEnergy / maxEnergy) * 100));
    
    // –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–∞–≥–∏—á–µ—Å–∫–æ–≥–æ –∫–≤–∞–¥—Ä–∞—Ç–∞
    const prediction = calculateMagicPrediction(magicValues, p1, p2, p3, totalEnergy);
    
    return {
        magicValues,
        row1, row2, row3,
        mainDiagonal, antiDiagonal,
        magicSumTotal,
        diagonalBalance,
        diagonalEnergy,
        centerPower,
        activeCells,
        totalEnergy,
        energyPercent,
        prediction
    };
}

function calculateMagicPrediction(magicValues, p1, p2, p3, totalEnergy) {
    const mainDiagonal = magicValues[0] + magicValues[4] + magicValues[8];
    const antiDiagonal = magicValues[2] + magicValues[4] + magicValues[6];
    
    const magicEnergy = (mainDiagonal + antiDiagonal) / 2;
    const periodTrend = p3 > p2 ? 1.1 : (p3 < p2 ? 0.9 : 1.0);
    
    // –ë–∞–∑–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞
    let basePrediction;
    if (currentMode === 'two') {
        basePrediction = (p1 + p2) * 2;
    } else {
        basePrediction = (p1 + p2 + p3) * (4/3);
    }
    
    // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –º–∞–≥–∏—á–µ—Å–∫–æ–π —ç–Ω–µ—Ä–≥–∏–µ–π (—á–µ–º –±–æ–ª—å—à–µ —ç–Ω–µ—Ä–≥–∏—è, —Ç–µ–º –≤—ã—à–µ —Ç–æ—Ç–∞–ª)
    const energyCorrection = 1 + (magicEnergy - 15) / 100;
    
    // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Ç—Ä–µ–Ω–¥–æ–º
    const trendCorrection = periodTrend;
    
    // –§–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑
    const finalPrediction = basePrediction * energyCorrection * trendCorrection;
    
    return {
        final: Math.round(finalPrediction),
        base: Math.round(basePrediction),
        energyCorrection: Math.round((energyCorrection - 1) * 100),
        trendCorrection: periodTrend.toFixed(1) + 'x'
    };
}

function updateMagicUI(calculations, magicValues) {
    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—É–º–º—ã
    document.getElementById('magicSumTotal').textContent = calculations.magicSumTotal;
    document.getElementById('row1Sum').textContent = calculations.row1;
    document.getElementById('row2Sum').textContent = calculations.row2;
    document.getElementById('row3Sum').textContent = calculations.row3;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∏–∞–≥–æ–Ω–∞–ª–∏
    document.getElementById('mainDiagonalSum').textContent = calculations.mainDiagonal;
    document.getElementById('antiDiagonalSum').textContent = calculations.antiDiagonal;
    document.getElementById('diagonalBalance').textContent = calculations.diagonalBalance;
    document.getElementById('diagonalEnergy').textContent = Math.round(calculations.diagonalEnergy);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–Ω–∞–ª–∏–∑ —ç–Ω–µ—Ä–≥–∏–∏
    document.getElementById('activeCells').textContent = `${calculations.activeCells}/9`;
    document.getElementById('centerPower').textContent = calculations.centerPower;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å —ç–Ω–µ—Ä–≥–∏–∏
    const energyLevel = calculations.energyPercent < 33 ? '–ù–∏–∑–∫–∏–π' : 
                       calculations.energyPercent < 66 ? '–°—Ä–µ–¥–Ω–∏–π' : '–í—ã—Å–æ–∫–∏–π';
    document.getElementById('energyLevel').textContent = energyLevel;
    
    const energyFill = document.getElementById('energyFill');
    energyFill.className = 'energy-fill ' + 
        (calculations.energyPercent < 33 ? 'energy-low' : 
         calculations.energyPercent < 66 ? 'energy-medium' : 'energy-high');
    energyFill.style.width = calculations.energyPercent + '%';
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥–Ω–æ–∑
    document.getElementById('magicPrediction').textContent = calculations.prediction.final;
    document.getElementById('basePrediction').textContent = calculations.prediction.base;
    document.getElementById('correctionValue').textContent = calculations.prediction.energyCorrection + '%';
    document.getElementById('energyValue').textContent = calculations.energyPercent + '%';
    document.getElementById('trendValue').textContent = calculations.prediction.trendCorrection;
    document.getElementById('magicResult').style.display = 'block';
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é
    updateMagicInterpretation(calculations);
}

function updateMagicInterpretation(calculations) {
    let interpretation = "";
    
    // –ê–Ω–∞–ª–∏–∑ —ç–Ω–µ—Ä–≥–∏–∏
    if (calculations.energyPercent < 25) {
        interpretation += "üåÄ <strong>–ù–∏–∑–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è</strong> - —Å–ª–∞–±–∞—è –≤–∑–∞–∏–º–æ—Å–≤—è–∑—å –¥–∞–Ω–Ω—ã—Ö. ";
    } else if (calculations.energyPercent < 50) {
        interpretation += "üí´ <strong>–£–º–µ—Ä–µ–Ω–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è</strong> - —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏. ";
    } else if (calculations.energyPercent < 75) {
        interpretation += "‚ö° <strong>–í—ã—Å–æ–∫–∞—è —ç–Ω–µ—Ä–≥–∏—è</strong> - —Å–∏–ª—å–Ω–∞—è –¥–∏–Ω–∞–º–∏–∫–∞. ";
    } else {
        interpretation += "üå™Ô∏è <strong>–ú–æ—â–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è</strong> - –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–∞—è –≤–∑–∞–∏–º–æ—Å–≤—è–∑—å! ";
    }
    
    // –ê–Ω–∞–ª–∏–∑ –¥–∏–∞–≥–æ–Ω–∞–ª–µ–π
    if (calculations.diagonalBalance > 10) {
        interpretation += "–ü—Ä–µ–æ–±–ª–∞–¥–∞–µ—Ç <strong>–≥–ª–∞–≤–Ω–∞—è –¥–∏–∞–≥–æ–Ω–∞–ª—å</strong> - —É—Å—Ç–æ–π—á–∏–≤—ã–π —Ç—Ä–µ–Ω–¥. ";
    } else if (calculations.diagonalBalance < -10) {
        interpretation += "–î–æ–º–∏–Ω–∏—Ä—É–µ—Ç <strong>–ø–æ–±–æ—á–Ω–∞—è –¥–∏–∞–≥–æ–Ω–∞–ª—å</strong> - –≤—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å. ";
    } else {
        interpretation += "<strong>–ë–∞–ª–∞–Ω—Å –¥–∏–∞–≥–æ–Ω–∞–ª–µ–π</strong> - —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∏–Ω–∞–º–∏–∫–∞. ";
    }
    
    // –ê–Ω–∞–ª–∏–∑ –∞–∫—Ç–∏–≤–Ω—ã—Ö —è—á–µ–µ–∫
    if (calculations.activeCells < 4) {
        interpretation += "–ú–∞–ª–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ - –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑. ";
    } else if (calculations.activeCells < 7) {
        interpretation += "–£–º–µ—Ä–µ–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –¥–∏–Ω–∞–º–∏–∫–∞. ";
    } else {
        interpretation += "–í—ã—Å–æ–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å - —ç–∫—Å–ø—Ä–µ—Å—Å–∏–≤–Ω–∞—è –∏–≥—Ä–∞! ";
    }
    
    // –ê–Ω–∞–ª–∏–∑ —Ü–µ–Ω—Ç—Ä–∞
    if (calculations.centerPower > 10) {
        interpretation += "–°–∏–ª—å–Ω—ã–π —Ü–µ–Ω—Ç—Ä –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å. ";
    } else if (calculations.centerPower < 5) {
        interpretation += "–°–ª–∞–±—ã–π —Ü–µ–Ω—Ç—Ä —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç—å. ";
    }
    
    document.getElementById('magicInterpretation').innerHTML = interpretation;
}

// –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
function updateVisualization() {
    const svg = document.querySelector('.triangle-svg');
    svg.innerHTML = '';
    
    const team1p1 = parseInt(document.getElementById('team1-period1').value) || 0;
    const team2p1 = parseInt(document.getElementById('team2-period1').value) || 0;
    const team1p2 = parseInt(document.getElementById('team1-period2').value) || 0;
    const team2p2 = parseInt(document.getElementById('team2-period2').value) || 0;
    const team1p3 = parseInt(document.getElementById('team1-period3').value) || 0;
    const team2p3 = parseInt(document.getElementById('team2-period3').value) || 0;
    
    const totalFirstPeriod = team1p1 + team2p1;
    const totalSecondPeriod = team1p2 + team2p2;
    const totalThirdPeriod = team1p3 + team2p3;
    
    const periodData = [totalFirstPeriod, totalSecondPeriod];
    if (currentMode === 'three') periodData.push(totalThirdPeriod);
    
    let mainTotal, additionalTotal;
    if (currentMode === 'two') {
        mainTotal = (totalFirstPeriod + totalSecondPeriod) * 2;
        if (totalFirstPeriod > totalSecondPeriod) {
            mainTotal += (totalFirstPeriod - totalSecondPeriod);
        } else {
            mainTotal -= (totalSecondPeriod - totalFirstPeriod);
        }
        additionalTotal = null;
    } else {
        mainTotal = (totalFirstPeriod + totalSecondPeriod + totalThirdPeriod) * (4/3);
        if (totalThirdPeriod > totalSecondPeriod) {
            mainTotal += (totalThirdPeriod - totalSecondPeriod);
        } else {
            mainTotal -= (totalSecondPeriod - totalThirdPeriod);
        }
        mainTotal = Math.round(mainTotal);
        
        const twoPeriodTotal = (totalFirstPeriod + totalSecondPeriod) * 2;
        const diffTwoPeriods = Math.abs(totalFirstPeriod - totalSecondPeriod);
        let adjustedTwoPeriodTotal = twoPeriodTotal;
        if (totalFirstPeriod > totalSecondPeriod) {
            adjustedTwoPeriodTotal += diffTwoPeriods;
        } else {
            adjustedTwoPeriodTotal -= diffTwoPeriods;
        }
        additionalTotal = Math.round((mainTotal + adjustedTwoPeriodTotal) / 2);
    }
    
    // –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ
    const expSmooth = exponentialSmoothing(periodData);
    const wReg = weightedRegression(periodData);
    const adaptive = adaptivePrediction(periodData);
    const risk = calculateRiskLevel(periodData);
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
    document.getElementById('expSmoothPrediction').textContent = expSmooth.prediction;
    document.getElementById('expSmoothAccuracy').textContent = expSmooth.accuracy + '%';
    document.getElementById('expSmoothConfidence').style.width = expSmooth.accuracy + '%';
    
    document.getElementById('weightedRegPrediction').textContent = wReg.prediction;
    document.getElementById('weightedRegInterval').textContent = wReg.interval[0] + ' - ' + wReg.interval[1];
    document.getElementById('weightedRegConfidence').style.width = wReg.confidence + '%';
    
    document.getElementById('adaptivePrediction').textContent = adaptive.prediction;
    document.getElementById('adaptiveSignal').textContent = adaptive.signal;
    document.getElementById('adaptiveConfidence').style.width = adaptive.confidence + '%';
    
    const riskIndicator = document.getElementById('riskIndicator');
    riskIndicator.className = 'risk-indicator risk-' + risk.level;
    document.getElementById('riskIcon').textContent = risk.icon;
    document.getElementById('riskText').textContent = risk.text;
    
    // –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞
    const points = [];
    if (currentMode === 'two') {
        points.push({x: 50, y: 250, value: totalFirstPeriod, label: '–ü–µ—Ä–∏–æ–¥ 1'});
        points.push({x: 150, y: 50, value: totalSecondPeriod, label: '–ü–µ—Ä–∏–æ–¥ 2'});
        points.push({x: 250, y: 250, value: mainTotal, label: '–¢–æ—Ç–∞–ª'});
    } else {
        points.push({x: 50, y: 250, value: totalFirstPeriod, label: '–ü–µ—Ä–∏–æ–¥ 1'});
        points.push({x: 150, y: 50, value: totalSecondPeriod, label: '–ü–µ—Ä–∏–æ–¥ 2'});
        points.push({x: 250, y: 250, value: totalThirdPeriod, label: '–ü–µ—Ä–∏–æ–¥ 3'});
        if (additionalTotal !== null) {
            points.push({x: 150, y: 150, value: additionalTotal, label: '–î–æ–ø. —Ä–∞—Å—á–µ—Ç'});
        }
    }
    
    if (points.length >= 3) {
        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        let pathData = `M ${points[0].x} ${points[0].y} `;
        for (let i = 1; i < points.length; i++) {
            pathData += `L ${points[i].x} ${points[i].y} `;
        }
        pathData += 'Z';
        path.setAttribute('d', pathData);
        path.setAttribute('fill', 'rgba(76, 201, 240, 0.2)');
        path.setAttribute('stroke', 'var(--primary)');
        path.setAttribute('stroke-width', '2');
        svg.appendChild(path);
    }
    
    points.forEach(point => {
        const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
        circle.setAttribute('cx', point.x);
        circle.setAttribute('cy', point.y);
        circle.setAttribute('r', '6');
        circle.setAttribute('fill', 'var(--primary)');
        circle.setAttribute('stroke', 'white');
        circle.setAttribute('stroke-width', '2');
        svg.appendChild(circle);
        
        const textValue = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        textValue.setAttribute('x', point.x);
        textValue.setAttribute('y', point.y - 12);
        textValue.setAttribute('text-anchor', 'middle');
        textValue.setAttribute('fill', 'white');
        textValue.setAttribute('font-size', '10');
        textValue.setAttribute('font-weight', 'bold');
        textValue.textContent = point.value;
        svg.appendChild(textValue);
        
        const textLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        textLabel.setAttribute('x', point.x);
        textLabel.setAttribute('y', point.y + 20);
        textLabel.setAttribute('text-anchor', 'middle');
        textLabel.setAttribute('fill', 'var(--secondary)');
        textLabel.setAttribute('font-size', '8');
        textLabel.textContent = point.label;
        svg.appendChild(textLabel);
    });
    
    let trendIcon, trendText, trendClass;
    if (periodData.length >= 2) {
        const lastTrend = periodData[periodData.length - 1] - periodData[periodData.length - 2];
        if (lastTrend > 5) {
            trendIcon = '‚ÜóÔ∏è';
            trendText = '–°–∏–ª—å–Ω—ã–π —Ä–æ—Å—Ç';
            trendClass = 'trend-up';
        } else if (lastTrend > 0) {
            trendIcon = '‚ÜóÔ∏è';
            trendText = '–£–º–µ—Ä–µ–Ω–Ω—ã–π —Ä–æ—Å—Ç';
            trendClass = 'trend-up';
        } else if (lastTrend < -5) {
            trendIcon = '‚ÜòÔ∏è';
            trendText = '–°–∏–ª—å–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ';
            trendClass = 'trend-down';
        } else if (lastTrend < 0) {
            trendIcon = '‚ÜòÔ∏è';
            trendText = '–£–º–µ—Ä–µ–Ω–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ';
            trendClass = 'trend-down';
        } else {
            trendIcon = '‚ÜîÔ∏è';
            trendText = '–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å';
            trendClass = 'trend-stable';
        }
    } else {
        trendIcon = '‚ÜîÔ∏è';
        trendText = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö';
        trendClass = 'trend-stable';
    }
    
    document.getElementById('trendIcon').textContent = trendIcon;
    document.getElementById('trendText').textContent = trendText;
    const trendIndicator = document.getElementById('trendIndicator');
    trendIndicator.classList.remove('trend-up', 'trend-down', 'trend-stable');
    trendIndicator.classList.add(trendClass);
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ –°–∏–¥–∏–∫–∞ –ê–≤–≥–∞–Ω–∞
function showSidikKeyboard(input) {
    // –°–∫—Ä—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –µ—Å–ª–∏ –æ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∞
    hideKeyboard();
    
    sidikCurrentInput = input;
    const keyboard = document.getElementById('sidik-customKeyboard');
    keyboard.style.display = 'grid';
    
    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ
    setTimeout(() => {
        keyboard.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }, 100);
}

function hideSidikKeyboard() {
    document.getElementById('sidik-customKeyboard').style.display = 'none';
    sidikCurrentInput = null;
}

function handleSidikKeyPress(value) {
    if (!sidikCurrentInput) return;
    
    if (value === 'clear') {
        sidikCurrentInput.value = '';
    } else if (value === 'done') {
        hideSidikKeyboard();
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Ä–∞—Å—á–µ—Ç –µ—Å–ª–∏ –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
        autoCalculateSidik();
    } else {
        // –î–æ–±–∞–≤–ª—è–µ–º —Ü–∏—Ñ—Ä—É –∫ —Ç–µ–∫—É—â–µ–º—É –∑–Ω–∞—á–µ–Ω–∏—é
        const currentValue = sidikCurrentInput.value;
        sidikCurrentInput.value = currentValue === '' ? value : currentValue + value;
    }
}

function updateSidikCurrentDateTime() {
    const now = new Date();
    document.getElementById('sidik-customDate').valueAsDate = now;
    document.getElementById('sidik-customTime').value = 
        `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
}

function calculateNumerologicalRoot(number) {
    let num = Math.abs(number);
    while (num > 9) {
        num = num.toString().split('').reduce((sum, digit) => sum + parseInt(digit), 0);
    }
    return num;
}

function findNearestWithRoot(target, targetRoot) {
    let upper = target;
    let lower = target;
    
    // –ò—â–µ–º –±–ª–∏–∂–∞–π—à–∏–µ —á–∏—Å–ª–∞ —Å –Ω—É–∂–Ω—ã–º –∫–æ—Ä–Ω–µ–º
    while (true) {
        if (calculateNumerologicalRoot(upper) === targetRoot) {
            return upper;
        }
        
        if (lower > 0 && calculateNumerologicalRoot(lower) === targetRoot) {
            return lower;
        }
        
        upper++;
        lower--;
        
        // –ó–∞—â–∏—Ç–∞ –æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
        if (upper > target + 100) {
            return target; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª –µ—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏
        }
    }
}

function getDateTimeFactors() {
    let dateTime;
    
    if (document.getElementById('sidik-useCurrentTime').checked) {
        dateTime = new Date();
    } else {
        const dateStr = document.getElementById('sidik-customDate').value;
        const timeStr = document.getElementById('sidik-customTime').value;
        const timezone = parseInt(document.getElementById('sidik-timezone').value);
        
        if (!dateStr || !timeStr) {
            // –ï—Å–ª–∏ –¥–∞—Ç–∞/–≤—Ä–µ–º—è –Ω–µ –≤—ã–±—Ä–∞–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â–∏–µ
            dateTime = new Date();
        } else {
            dateTime = new Date(`${dateStr}T${timeStr}:00Z`);
            // –£—á–∏—Ç—ã–≤–∞–µ–º —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å
            dateTime.setHours(dateTime.getHours() - timezone);
        }
    }
    
    // –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
    const year = dateTime.getFullYear();
    const month = dateTime.getMonth() + 1;
    const day = dateTime.getDate();
    const hour = dateTime.getHours();
    const minute = dateTime.getMinutes();
    const dayOfWeek = dateTime.getDay() === 0 ? 7 : dateTime.getDay();
    
    // –í—ã—á–∏—Å–ª—è–µ–º —Ñ–∞–∫—Ç–æ—Ä—ã
    const dateFactor = calculateNumerologicalRoot(day + month + year);
    const timeFactor = calculateNumerologicalRoot(hour + minute);
    const dayOfWeekFactor = dayOfWeek;
    const combinedFactor = calculateNumerologicalRoot(dateFactor + timeFactor + dayOfWeekFactor);
    
    return {
        dateTime,
        dateFactor,
        timeFactor,
        dayOfWeekFactor,
        combinedFactor,
        components: { year, month, day, hour, minute, dayOfWeek }
    };
}

function calculateFourthPeriod(period1, period2, period3, root1, root2, root3, datetimeFactors) {
    // –£—Å—Ä–µ–¥–Ω–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–æ–≤
    const mean = Math.round((period1 + period2 + period3) / 3);
    
    // –í—ã—á–∏—Å–ª—è–µ–º –æ–∂–∏–¥–∞–µ–º—ã–π –∫–æ—Ä–µ–Ω—å –¥–ª—è 4-–≥–æ –ø–µ—Ä–∏–æ–¥–∞
    const sumRoots = root1 + root2 + root3;
    const adjustedSum = sumRoots + datetimeFactors.combinedFactor;
    
    let root4;
    if (adjustedSum % 9 === 0) {
        root4 = 9;
    } else {
        root4 = adjustedSum % 9;
    }
    
    // –ù–∞—Ö–æ–¥–∏–º –±–ª–∏–∂–∞–π—à–µ–µ —á–∏—Å–ª–æ —Å –Ω—É–∂–Ω—ã–º –∫–æ—Ä–Ω–µ–º
    return findNearestWithRoot(mean, root4);
}

function updateDateTimeAnalysis(datetimeFactors) {
    const analysisElement = document.getElementById('sidik-datetimeAnalysis');
    const { dateFactor, timeFactor, dayOfWeekFactor, combinedFactor, components } = datetimeFactors;
    
    const dayNames = ['', '–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–≤—Ç–æ—Ä–Ω–∏–∫', '—Å—Ä–µ–¥—É', '—á–µ—Ç–≤–µ—Ä–≥', '–ø—è—Ç–Ω–∏—Ü—É', '—Å—É–±–±–æ—Ç—É', '–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ'];
    const monthNames = [
        '', '—è–Ω–≤–∞—Ä—è', '—Ñ–µ–≤—Ä–∞–ª—è', '–º–∞—Ä—Ç–∞', '–∞–ø—Ä–µ–ª—è', '–º–∞—è', '–∏—é–Ω—è',
        '–∏—é–ª—è', '–∞–≤–≥—É—Å—Ç–∞', '—Å–µ–Ω—Ç—è–±—Ä—è', '–æ–∫—Ç—è–±—Ä—è', '–Ω–æ—è–±—Ä—è', '–¥–µ–∫–∞–±—Ä—è'
    ];
    
    let analysis = `–†–∞—Å—á–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –¥–ª—è ${components.day} ${monthNames[components.month]} ${components.year} –≥–æ–¥–∞, `;
    analysis += `${components.hour.toString().padStart(2, '0')}:${components.minute.toString().padStart(2, '0')} (${dayNames[components.dayOfWeek]}). `;
    analysis += `–§–∞–∫—Ç–æ—Ä—ã: –¥–∞—Ç–∞=${dateFactor}, –≤—Ä–µ–º—è=${timeFactor}, –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏=${dayOfWeekFactor}. `;
    analysis += `–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–∫—Ç–æ—Ä: ${combinedFactor}.`;
    
    analysisElement.textContent = analysis;
}

function generateSidikMagicSquare(root1, root2, root3, root4, datetimeFactors) {
    const magicSquare = document.getElementById('sidik-magicSquare');
    magicSquare.innerHTML = '';
    
    // –ú–∞–≥–∏—á–µ—Å–∫–∏–π –∫–≤–∞–¥—Ä–∞—Ç 4x4
    const baseSquare = [
        16, 3, 2, 13,
        5, 10, 11, 8,
        9, 6, 7, 12,
        4, 15, 14, 1
    ];
    
    // –ê–¥–∞–ø—Ç–∏—Ä—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è —Å —É—á–µ—Ç–æ–º –ø–µ—Ä–∏–æ–¥–æ–≤ –∏ —Ñ–∞–∫—Ç–æ—Ä–æ–≤
    for (let i = 0; i < 16; i++) {
        const cell = document.createElement('div');
        cell.className = 'sidik-square-cell';
        
        let value = baseSquare[i];
        
        // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ—Ä–Ω–µ–π –ø–µ—Ä–∏–æ–¥–æ–≤
        if (i === 0) value += root1 - 1;
        if (i === 3) value += root2 - 1;
        if (i === 12) value += root3 - 1;
        if (i === 15) value += root4 - 1;
        
        // –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–µ —è—á–µ–π–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ–∞–∫—Ç–æ—Ä–∞ –¥–∞—Ç—ã/–≤—Ä–µ–º–µ–Ω–∏
        if (i === 5 || i === 6 || i === 9 || i === 10) {
            value += datetimeFactors.combinedFactor;
        }
        
        // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è
        value = ((value - 1) % 16) + 1;
        
        cell.textContent = value;
        
        // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º —É–≥–ª–æ–≤—ã–µ —è—á–µ–π–∫–∏ (–ø–µ—Ä–∏–æ–¥—ã)
        if (i === 0 || i === 3 || i === 12 || i === 15) {
            cell.classList.add('highlight');
        }
        
        magicSquare.appendChild(cell);
    }
}

function findNumbersWithRoot(targetRoot, nearValue, count = 5) {
    const numbers = [];
    let current = nearValue;
    
    // –ò—â–µ–º —á–∏—Å–ª–∞ –≤—ã—à–µ –∏ –Ω–∏–∂–µ nearValue —Å –Ω—É–∂–Ω—ã–º –∫–æ—Ä–Ω–µ–º
    for (let offset = 0; numbers.length < count && offset < 50; offset++) {
        const upper = nearValue + offset;
        const lower = nearValue - offset;
        
        if (lower > 0 && calculateNumerologicalRoot(lower) === targetRoot && !numbers.includes(lower)) {
            numbers.push(lower);
        }
        
        if (calculateNumerologicalRoot(upper) === targetRoot && !numbers.includes(upper)) {
            numbers.push(upper);
        }
    }
    
    return numbers.sort((a, b) => a - b).slice(0, count);
}

function getRootMeaning(root) {
    const meanings = {
        1: "–ù–∞—á–∞–ª–æ, –ª–∏–¥–µ—Ä—Å—Ç–≤–æ, —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å",
        2: "–ë–∞–ª–∞–Ω—Å, –ø–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ, –≥–∞—Ä–º–æ–Ω–∏—è", 
        3: "–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ, —Ä–æ—Å—Ç, —ç–∫—Å–ø—Ä–µ—Å—Å–∏—è",
        4: "–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, –ø–æ—Ä—è–¥–æ–∫, –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å",
        5: "–ò–∑–º–µ–Ω–µ–Ω–∏—è, —Å–≤–æ–±–æ–¥–∞, –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å",
        6: "–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å, –∑–∞–±–æ—Ç–∞, —Å–µ–º—å—è",
        7: "–ê–Ω–∞–ª–∏–∑, –º—É–¥—Ä–æ—Å—Ç—å, –∏–Ω—Ç—É–∏—Ü–∏—è", 
        8: "–ò–∑–æ–±–∏–ª–∏–µ, —É—Å–ø–µ—Ö, –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ –±–ª–∞–≥–∞",
        9: "–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ, –º—É–¥—Ä–æ—Å—Ç—å, —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è"
    };
    
    return meanings[root] || "–ù–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è";
}

function generateSidikAnalysis(root1, root2, root3, root4, totalRoot, datetimeFactors) {
    const analysisText = document.getElementById('sidik-analysisText');
    
    let analysis = '';
    
    // –ê–Ω–∞–ª–∏–∑ –ø–µ—Ä–∏–æ–¥–æ–≤
    analysis += `<p><strong>–ê–Ω–∞–ª–∏–∑ –ø–µ—Ä–∏–æ–¥–æ–≤:</strong> –ü1(–∫–æ—Ä–µ–Ω—å ${root1}) ‚Üí ${getRootMeaning(root1)}, `;
    analysis += `–ü2(–∫–æ—Ä–µ–Ω—å ${root2}) ‚Üí ${getRootMeaning(root2)}, `;
    analysis += `–ü3(–∫–æ—Ä–µ–Ω—å ${root3}) ‚Üí ${getRootMeaning(root3)}</p>`;
    
    // –ê–Ω–∞–ª–∏–∑ —á–µ—Ç–≤–µ—Ä—Ç–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
    analysis += `<p><strong>4-–π –ø–µ—Ä–∏–æ–¥ (–∫–æ—Ä–µ–Ω—å ${root4}):</strong> ${getRootMeaning(root4)}</p>`;
    
    // –ê–Ω–∞–ª–∏–∑ –æ–±—â–µ–≥–æ —Ç–æ—Ç–∞–ª–∞
    analysis += `<p><strong>–û–±—â–∏–π —Ç–æ—Ç–∞–ª (–∫–æ—Ä–µ–Ω—å ${totalRoot}):</strong> ${getRootMeaning(totalRoot)}</p>`;
    
    // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
    if (totalRoot === 7 || root4 === 7) {
        analysis += `<p>‚ú® <strong>–û—Å–æ–±—ã–π –∑–Ω–∞–∫:</strong> –ß–∏—Å–ª–æ 7 - —Å–∏–º–≤–æ–ª —É–¥–∞—á–∏ –∏ –∏–Ω—Ç—É–∏—Ü–∏–∏</p>`;
    }
    
    if ([root1, root2, root3, root4].filter(root => root === 8).length >= 2) {
        analysis += `<p>üí∞ <strong>–ë–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω—ã–π –∑–Ω–∞–∫:</strong> –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–µ—Ä–∏–æ–¥–æ–≤ —Å –∫–æ—Ä–Ω–µ–º 8 - –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –∏–∑–æ–±–∏–ª–∏—è</p>`;
    }
    
    if (totalRoot === root4) {
        analysis += `<p>üîÑ <strong>–°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å:</strong> –ö–æ—Ä–µ–Ω—å —Ç–æ—Ç–∞–ª–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∫–æ—Ä–Ω–µ–º 4-–≥–æ –ø–µ—Ä–∏–æ–¥–∞</p>`;
    }
    
    analysisText.innerHTML = analysis;
}

function calculateSidikPredictions() {
    const period1 = parseInt(document.getElementById('sidik-period1').value) || 0;
    const period2 = parseInt(document.getElementById('sidik-period2').value) || 0;
    const period3 = parseInt(document.getElementById('sidik-period3').value) || 0;
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
    if (period1 <= 0 || period2 <= 0 || period3 <= 0) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ —Ç—Ä–∏ –ø–µ—Ä–∏–æ–¥–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º–∏ —á–∏—Å–ª–∞–º–∏');
        return;
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    document.getElementById('sidik-loader').style.display = 'block';
    document.getElementById('sidik-results').style.display = 'none';
    
    // –ò–º–∏—Ç–∏—Ä—É–µ–º —Ä–∞—Å—á–µ—Ç –¥–ª—è –ª—É—á—à–µ–≥–æ UX
    setTimeout(() => {
        try {
            // –ü–æ–ª—É—á–∞–µ–º —Ñ–∞–∫—Ç–æ—Ä—ã –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
            const datetimeFactors = getDateTimeFactors();
            
            // –í—ã—á–∏—Å–ª—è–µ–º –Ω—É–º–µ—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∫–æ—Ä–Ω–∏
            const root1 = calculateNumerologicalRoot(period1);
            const root2 = calculateNumerologicalRoot(period2);
            const root3 = calculateNumerologicalRoot(period3);
            
            // –í—ã—á–∏—Å–ª—è–µ–º —á–µ—Ç–≤–µ—Ä—Ç—ã–π –ø–µ—Ä–∏–æ–¥
            const period4 = calculateFourthPeriod(period1, period2, period3, root1, root2, root3, datetimeFactors);
            const root4 = calculateNumerologicalRoot(period4);
            
            // –í—ã—á–∏—Å–ª—è–µ–º –æ–±—â–∏–π —Ç–æ—Ç–∞–ª
            const total = period1 + period2 + period3 + period4;
            const totalRoot = calculateNumerologicalRoot(total);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            document.getElementById('sidik-period4Result').textContent = period4;
            document.getElementById('sidik-period4Root').textContent = root4;
            document.getElementById('sidik-totalResult').textContent = total;
            document.getElementById('sidik-totalRoot').textContent = totalRoot;
            document.getElementById('sidik-datetimeFactor').textContent = datetimeFactors.combinedFactor;
            document.getElementById('sidik-datetimeUsed').textContent = 
                datetimeFactors.dateTime.toLocaleDateString('ru-RU') + ' ' + 
                datetimeFactors.dateTime.toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit'});
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–Ω–∞–ª–∏–∑ –¥–∞—Ç—ã/–≤—Ä–µ–º–µ–Ω–∏
            updateDateTimeAnalysis(datetimeFactors);
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –º–∞–≥–∏—á–µ—Å–∫–∏–π –∫–≤–∞–¥—Ä–∞—Ç
            generateSidikMagicSquare(root1, root2, root3, root4, datetimeFactors);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
            document.getElementById('sidik-recPeriodRoot').textContent = root4;
            document.getElementById('sidik-recTotalRoot').textContent = totalRoot;
            
            // –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —á–µ—Ç–≤–µ—Ä—Ç–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
            const periodRecs = document.getElementById('sidik-periodRecommendations');
            periodRecs.innerHTML = '';
            
            const periodNumbers = findNumbersWithRoot(root4, period4, 8);
            periodNumbers.forEach(num => {
                const item = document.createElement('div');
                item.className = 'sidik-recommendation-item';
                item.textContent = num;
                periodRecs.appendChild(item);
            });
            
            // –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –æ–±—â–µ–≥–æ —Ç–æ—Ç–∞–ª–∞
            const totalRecs = document.getElementById('sidik-totalRecommendations');
            totalRecs.innerHTML = '';
            
            const totalNumbers = findNumbersWithRoot(totalRoot, total, 8);
            totalNumbers.forEach(num => {
                const item = document.createElement('div');
                item.className = 'sidik-recommendation-item';
                item.textContent = num;
                totalRecs.appendChild(item);
            });
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∞–Ω–∞–ª–∏–∑
            generateSidikAnalysis(root1, root2, root3, root4, totalRoot, datetimeFactors);
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞:', error);
            alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–≤–µ–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.');
        } finally {
            document.getElementById('sidik-loader').style.display = 'none';
            document.getElementById('sidik-results').style.display = 'block';
        }
    }, 1000);
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
document.addEventListener('DOMContentLoaded', function() {
    const savedTheme = localStorage.getItem('selectedTheme') || 'sun';
    setTheme(savedTheme);
    document.querySelector(`[onclick="setTheme('${savedTheme}')"]`).classList.add('active');
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–∞–≥–∏—á–µ—Å–∫–∏–π –∫–≤–∞–¥—Ä–∞—Ç
    updateMagicSquare();
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª–∞–¥–∫–∏ –°–∏–¥–∏–∫–∞ –ê–≤–≥–∞–Ω–∞
    updateSidikCurrentDateTime();
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
    document.getElementById('sidik-useCurrentTime').addEventListener('change', function() {
        document.getElementById('sidik-datetimeControls').style.display = this.checked ? 'none' : 'flex';
        if (this.checked) {
            updateSidikCurrentDateTime();
        }
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
    const sidikKeyboard = document.getElementById('sidik-customKeyboard');
    const keyboardKeys = sidikKeyboard.querySelectorAll('.sidik-keyboard-key');
    
    keyboardKeys.forEach(key => {
        key.addEventListener('click', function() {
            const value = this.getAttribute('data-value');
            if (value) {
                handleSidikKeyPress(value);
            } else if (this.classList.contains('clear')) {
                handleSidikKeyPress('clear');
            } else if (this.classList.contains('done')) {
                handleSidikKeyPress('done');
            }
        });
    });
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –∫–∞—Å—Ç–æ–º–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–µ
    document.addEventListener('click', function(e) {
        const keyboard = document.getElementById('sidik-customKeyboard');
        const inputs = document.querySelectorAll('#sidik-period1, #sidik-period2, #sidik-period3');
        
        if (keyboard.style.display === 'grid' && 
            !keyboard.contains(e.target) && 
            !Array.from(inputs).some(input => input.contains(e.target))) {
            hideSidikKeyboard();
        }
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ —Ä–∞—Å—á–µ—Ç–∞
    document.getElementById('sidik-calculateBtn').addEventListener('click', calculateSidikPredictions);
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π –≤–≤–æ–¥–∞
    const sidikInputs = document.querySelectorAll('#sidik-period1, #sidik-period2, #sidik-period3');
    sidikInputs.forEach(input => {
        input.addEventListener('input', function() {
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Ä–∞—Å—á–µ—Ç –µ—Å–ª–∏ –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
            autoCalculateSidik();
        });
    });
    
    // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
    updateSidikFromCalculator();
});
</script>
</body>
</html>
